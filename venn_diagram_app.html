<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ベン図メーカー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        .control-panel input {
            transition: all 0.2s ease-in-out;
        }
        .control-panel input:focus {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(66, 153, 225, 0.5);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">ベン図メーカー</h1>
            <p class="text-gray-600 mt-2">数値を入力すると、下の図にリアルタイムで反映されます。</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:items-start">
            <!-- コントロールパネル -->
            <div id="control-panel" class="lg:col-span-1 space-y-6 control-panel">
                <div>
                    <div class="flex items-center justify-center space-x-2 mb-4">
                        <button id="two-sets-btn" class="flex-1 py-2 px-4 rounded-lg font-semibold transition bg-blue-500 text-white shadow-md hover:bg-blue-600">2つの集合</button>
                        <button id="three-sets-btn" class="flex-1 py-2 px-4 rounded-lg font-semibold transition bg-gray-200 text-gray-700 hover:bg-gray-300">3つの集合</button>
                    </div>
                </div>

                <!-- 2つの集合用入力 -->
                <div id="two-sets-inputs" class="space-y-3">
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-only" class="font-medium text-gray-700">Aのみ</label>
                        <input type="number" id="val-a-only" value="10" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-b-only" class="font-medium text-gray-700">Bのみ</label>
                        <input type="number" id="val-b-only" value="12" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-and-b" class="font-medium text-gray-700">AとB (A∩B)</label>
                        <input type="number" id="val-a-and-b" value="5" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-outside-2" class="font-medium text-gray-700">AでもBでもない</label>
                        <input type="number" id="val-outside-2" value="8" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                </div>

                <!-- 3つの集合用入力 -->
                <div id="three-sets-inputs" class="space-y-3 hidden">
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-only-3" class="font-medium">Aのみ</label>
                        <input type="number" id="val-a-only-3" value="7" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                     <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-b-only-3" class="font-medium">Bのみ</label>
                        <input type="number" id="val-b-only-3" value="8" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                     <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-c-only-3" class="font-medium">Cのみ</label>
                        <input type="number" id="val-c-only-3" value="9" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-b-only" class="font-medium">AとBのみ</label>
                        <input type="number" id="val-a-b-only" value="3" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                     <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-c-only" class="font-medium">AとCのみ</label>
                        <input type="number" id="val-a-c-only" value="4" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                     <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-b-c-only" class="font-medium">BとCのみ</label>
                        <input type="number" id="val-b-c-only" value="5" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-a-b-c" class="font-medium">AとBとC</label>
                        <input type="number" id="val-a-b-c" value="2" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="val-outside-3" class="font-medium">AでもBでもCでもない</label>
                        <input type="number" id="val-outside-3" value="6" min="0" class="w-full p-2 border rounded-md text-center focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                </div>

                <!-- 計算結果 -->
                <div id="results-panel" class="pt-6 border-t border-gray-200 space-y-2 text-sm text-gray-700 h-48">
                    <!-- 結果はJSで動的に挿入されます -->
                </div>
            </div>

            <!-- ベン図表示エリア -->
            <div class="lg:col-span-2 flex items-center justify-center bg-gray-50 rounded-lg min-h-[300px] md:min-h-[400px]">
                <canvas id="venn-canvas"></canvas>
            </div>
        </main>
    </div>

    <script>
        const canvas = document.getElementById('venn-canvas');
        const ctx = canvas.getContext('2d');
        let mode = 'two'; // 'two' or 'three'

        // 入力要素
        const inputs = {
            two: {
                a_only: document.getElementById('val-a-only'),
                b_only: document.getElementById('val-b-only'),
                a_and_b: document.getElementById('val-a-and-b'),
                outside: document.getElementById('val-outside-2'),
            },
            three: {
                a_only: document.getElementById('val-a-only-3'),
                b_only: document.getElementById('val-b-only-3'),
                c_only: document.getElementById('val-c-only-3'),
                a_b_only: document.getElementById('val-a-b-only'),
                a_c_only: document.getElementById('val-a-c-only'),
                b_c_only: document.getElementById('val-b-c-only'),
                a_b_c: document.getElementById('val-a-b-c'),
                outside: document.getElementById('val-outside-3'),
            }
        };

        const twoSetsBtn = document.getElementById('two-sets-btn');
        const threeSetsBtn = document.getElementById('three-sets-btn');
        const twoSetsInputs = document.getElementById('two-sets-inputs');
        const threeSetsInputs = document.getElementById('three-sets-inputs');
        const resultsPanel = document.getElementById('results-panel');

        function getValues() {
            const values = {};
            if (mode === 'two') {
                for (const key in inputs.two) {
                    values[key] = parseInt(inputs.two[key].value, 10) || 0;
                }
            } else {
                 for (const key in inputs.three) {
                    values[key] = parseInt(inputs.three[key].value, 10) || 0;
                }
            }
            return values;
        }

        function calculateResults(values) {
            let results = {};
            if (mode === 'two') {
                const a = values.a_only + values.a_and_b;
                const b = values.b_only + values.a_and_b;
                const a_or_b = values.a_only + values.b_only + values.a_and_b;
                const u = a_or_b + values.outside;
                results = {
                    'A': a,
                    'B': b,
                    'AまたはB (A&cup;B)': a_or_b,
                    '全体 (U)': u
                };
            } else {
                const a = values.a_only + values.a_b_only + values.a_c_only + values.a_b_c;
                const b = values.b_only + values.a_b_only + values.b_c_only + values.a_b_c;
                const c = values.c_only + values.a_c_only + values.b_c_only + values.a_b_c;
                const a_or_b_or_c = values.a_only + values.b_only + values.c_only + values.a_b_only + values.a_c_only + values.b_c_only + values.a_b_c;
                const u = a_or_b_or_c + values.outside;
                 results = {
                    'A': a,
                    'B': b,
                    'C': c,
                    'AまたはBまたはC (A&cup;B&cup;C)': a_or_b_or_c,
                    '全体 (U)': u
                };
            }

            resultsPanel.innerHTML = '<h3 class="font-bold text-lg mb-2 text-gray-800">計算結果</h3>';
            for(const key in results) {
                resultsPanel.innerHTML += `
                    <div class="flex justify-between">
                        <span>${key}</span>
                        <span class="font-semibold">${results[key]}</span>
                    </div>
                `;
            }
        }

        function draw() {
            const values = getValues();
            calculateResults(values);
            
            requestAnimationFrame(() => {
                const container = canvas.parentElement;
                const size = Math.min(container.clientWidth, container.clientHeight);
                canvas.width = size;
                canvas.height = size;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                if (size < 20) {
                    return;
                }
                
                const lineWidth = Math.max(1, size * 0.004); 
                const margin = lineWidth * 3;
                const drawRect = {
                    x: margin,
                    y: margin,
                    width: Math.max(0, canvas.width - margin * 2),
                    height: Math.max(0, canvas.height - margin * 2)
                };
                const centerX = drawRect.x + drawRect.width / 2;
                const centerY = drawRect.y + drawRect.height / 2;
                const radius = drawRect.width / 4;

                ctx.strokeStyle = '#888888';
                ctx.lineWidth = lineWidth;
                ctx.strokeRect(drawRect.x, drawRect.y, drawRect.width, drawRect.height);

                const labelFontSize = Math.max(18, Math.min(radius * 0.4, 36)); 
                ctx.fillStyle = '#333';
                ctx.font = `${labelFontSize}px 'Inter', sans-serif`;
                ctx.textAlign = 'left';
                ctx.textBaseline = 'top';
                const uLabelX = drawRect.x + (labelFontSize * 0.25);
                const uLabelY = drawRect.y + (labelFontSize * 0.25);
                ctx.fillText('U', uLabelX, uLabelY);

                if (mode === 'two') {
                    drawTwoSetVenn(values, centerX, centerY, radius, labelFontSize);
                } else {
                    drawThreeSetVenn(values, centerX, centerY, radius, labelFontSize, uLabelX, uLabelY);
                }
            });
        }
        
        function drawTwoSetVenn(values, centerX, centerY, radius, labelFontSize) {
            let c1x, c2x, currentRadius;
            const cy = centerY;

            const shouldDrawA = (values.a_only + values.a_and_b) > 0;
            const shouldDrawB = (values.b_only + values.a_and_b) > 0;

            if (shouldDrawA && !shouldDrawB) {
                currentRadius = radius;
                c1x = centerX;
            } else if (!shouldDrawA && shouldDrawB) {
                currentRadius = radius;
                c2x = centerX;
            } else if (shouldDrawA && shouldDrawB) {
                if (values.a_and_b === 0) {
                    currentRadius = radius * 0.8; 
                    const gap = radius * 0.15;
                    c1x = centerX - currentRadius - gap;
                    c2x = centerX + currentRadius + gap;
                } else {
                    currentRadius = radius;
                    c1x = centerX - radius / 2;
                    c2x = centerX + radius / 2;
                }
            }

            if (shouldDrawA) {
                ctx.globalAlpha = 0.2;
                ctx.fillStyle = '#2563eb';
                ctx.beginPath();
                ctx.arc(c1x, cy, currentRadius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.globalAlpha = 1.0;
                ctx.strokeStyle = '#1d4ed8';
                ctx.beginPath();
                ctx.arc(c1x, cy, currentRadius, 0, 2 * Math.PI);
                ctx.stroke();
            }
            
            if (shouldDrawB) {
                ctx.globalAlpha = 0.2;
                ctx.fillStyle = '#dc2626';
                ctx.beginPath();
                ctx.arc(c2x, cy, currentRadius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.globalAlpha = 1.0;
                ctx.strokeStyle = '#991b1b';
                ctx.beginPath();
                ctx.arc(c2x, cy, currentRadius, 0, 2 * Math.PI);
                ctx.stroke();
            }

            const textFontSize = Math.max(10, Math.min(radius * 0.25, 24));
            ctx.fillStyle = '#000';
            ctx.font = `500 ${textFontSize}px 'Inter', sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            if (shouldDrawA && !shouldDrawB) {
                ctx.fillText(values.a_only, c1x, cy);
            } else if (!shouldDrawA && shouldDrawB) {
                ctx.fillText(values.b_only, c2x, cy);
            } else if (shouldDrawA && shouldDrawB) {
                if (values.a_and_b === 0) {
                    ctx.fillText(values.a_only, c1x, cy);
                    ctx.fillText(values.b_only, c2x, cy);
                } else {
                    ctx.fillText(values.a_only, c1x - currentRadius / 2, cy);
                    ctx.fillText(values.b_only, c2x + currentRadius / 2, cy);
                    ctx.fillText(values.a_and_b, centerX, cy);
                }
            }
            
            ctx.fillText(values.outside, centerX, centerY - radius * 1.5);

            ctx.font = `${labelFontSize}px 'Inter', sans-serif`;
            if (shouldDrawA) {
                ctx.fillStyle = '#1d4ed8';
                ctx.fillText('A', c1x - currentRadius * 0.85, cy - currentRadius * 0.85);
            }
            if (shouldDrawB) {
                ctx.fillStyle = '#991b1b';
                ctx.fillText('B', c2x + currentRadius * 0.85, cy - currentRadius * 0.85);
            }
        }

        function drawThreeSetVenn(values, centerX, centerY, radius, labelFontSize, uLabelX, uLabelY) {
            const r = radius * 0.9;
            const offset = r * 0.5;
            
            const c1x = centerX;
            const c1y = centerY - offset;
            const c2x = centerX - offset * Math.sqrt(3) / 2 - offset/2;
            const c2y = centerY + offset * 0.9; 
            const c3x = centerX + offset * Math.sqrt(3) / 2 + offset/2;
            const c3y = centerY + offset * 0.9; 
            
            ctx.globalAlpha = 0.2;
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.arc(c1x, c1y, r, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#dc2626';
            ctx.beginPath();
            ctx.arc(c2x, c2y, r, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = '#f59e0b';
            ctx.beginPath();
            ctx.arc(c3x, c3y, r, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
            
            ctx.strokeStyle = '#1d4ed8';
            ctx.beginPath();
            ctx.arc(c1x, c1y, r, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.strokeStyle = '#991b1b';
            ctx.beginPath();
            ctx.arc(c2x, c2y, r, 0, Math.PI * 2);
            ctx.stroke();
            
            ctx.strokeStyle = '#b45309';
            ctx.beginPath();
            ctx.arc(c3x, c3y, r, 0, Math.PI * 2);
            ctx.stroke();

            const textFontSize = Math.max(12, Math.min(r * 0.25, 24));
            ctx.font = `500 ${textFontSize}px 'Inter', sans-serif`;
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            ctx.fillText(values.a_only, c1x, c1y - r/2);
            ctx.fillText(values.b_only, c2x - r/2, c2y + r/2);
            ctx.fillText(values.c_only, c3x + r/2, c3y + r/2);
            ctx.fillText(values.a_b_only, centerX - r*0.55, centerY - r*0.1);
            ctx.fillText(values.a_c_only, centerX + r*0.55, centerY - r*0.1);
            ctx.fillText(values.b_c_only, centerX, centerY + r*0.8);
            ctx.fillText(values.a_b_c, centerX, centerY + r*0.3);
            
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            ctx.fillText(values.outside, uLabelX + labelFontSize * 1.6, uLabelY + labelFontSize * 1.2);
            
            const labelFontSize3 = labelFontSize * 0.9;
            ctx.font = `${labelFontSize3}px 'Inter', sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            ctx.fillStyle = '#1d4ed8';
            ctx.fillText('A', c1x, c1y - r * 1.2);
            ctx.fillStyle = '#991b1b';
            ctx.fillText('B', c2x - r * 1.15, c2y - r * 0.3);
            ctx.fillStyle = '#b45309';
            ctx.fillText('C', c3x + r * 1.15, c3y - r * 0.3);
        }

        function switchMode(newMode) {
            mode = newMode;
            if (mode === 'two') {
                twoSetsBtn.classList.add('bg-blue-500', 'text-white', 'shadow-md', 'hover:bg-blue-600');
                twoSetsBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                
                threeSetsBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                threeSetsBtn.classList.remove('bg-blue-500', 'text-white', 'shadow-md', 'hover:bg-blue-600');

                twoSetsInputs.classList.remove('hidden');
                threeSetsInputs.classList.add('hidden');
            } else {
                threeSetsBtn.classList.add('bg-blue-500', 'text-white', 'shadow-md', 'hover:bg-blue-600');
                threeSetsBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');

                twoSetsBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                twoSetsBtn.classList.remove('bg-blue-500', 'text-white', 'shadow-md', 'hover:bg-blue-600');
                
                threeSetsInputs.classList.remove('hidden');
                twoSetsInputs.classList.add('hidden');
            }
            draw();
        }

        function handleInput(event) {
            if (parseInt(event.target.value, 10) < 0) {
                event.target.value = '0';
            }
            draw();
        }

        twoSetsBtn.addEventListener('click', () => switchMode('two'));
        threeSetsBtn.addEventListener('click', () => switchMode('three'));

        Object.values(inputs.two).forEach(input => input.addEventListener('input', handleInput));
        Object.values(inputs.three).forEach(input => input.addEventListener('input', handleInput));
        
        // requestAnimationFrame を draw の外で呼び出すように変更
        window.addEventListener('resize', draw);

        // Initial draw
        draw();
    </script>
</body>
</html>
